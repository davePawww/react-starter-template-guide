<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CI/CD Pipeline - React Starter Template</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header>
        <div class="logo">âš¡ React Starter Template</div>
        <nav>
            <a href="index.html">Home</a>
            <a href="installation.html">Installation</a>
            <a href="tools.html">Tools</a>
            <a href="cicd.html">CI/CD</a>
            <a href="deployment.html">Deployment</a>
        </nav>
    </header>

    <main>
        <aside class="sidebar">
            <h3>On This Page</h3>
            <ul>
                <li><a href="#workflow">CI/CD Workflow</a></li>
                <li><a href="#setup">Setup</a></li>
                <li><a href="#vercel-secrets">Vercel Secrets</a></li>
            </ul>
        </aside>

        <article class="content">
            <h1>CI/CD Pipeline</h1>
            <p class="lead">Set up automated testing and deployment with GitHub Actions.</p>

            <section id="workflow">
                <h2>CI/CD Workflow</h2>
                <div class="why-box">
                    <strong>Why This Setup?</strong>
                    <p>This workflow runs all checks on every push and PR, but only deploys to Vercel when code is merged to main or master. It includes both unit tests (Vitest) and E2E tests (Playwright) for comprehensive coverage.</p>
                </div>

                <div class="code-block">
                    <div class="code-header">
                        <span>.github/workflows/ci-cd.yml</span>
                        <button onclick="copyCode(this)">Copy</button>
                    </div>
                    <pre><code>name: CI/CD

on:
  push:
    branches: [main, master]
  pull_request:
    branches: [main, master]

jobs:
  lint-and-test:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Install pnpm
        uses: pnpm/action-setup@v4
        with:
          version: 9

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'pnpm'

      - name: Install dependencies
        run: pnpm install --frozen-lockfile

      - name: Install Playwright browsers
        run: pnpm exec playwright install chromium

      - name: Cache Playwright browsers
        uses: actions/cache@v4
        with:
          path: ~/.cache/ms-playwright
          key: playwright-${{ runner.os }}-${{ hashFiles('pnpm-lock.yaml') }}
          restore-keys: |
            playwright-${{ runner.os }}-

      - name: Run linter
        run: pnpm run lint

      - name: Run tests
        run: pnpm run test:all

      - name: Build project
        run: pnpm run build

  deploy:
    needs: lint-and-test
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/main' || github.ref == 'refs/heads/master'
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Install pnpm
        uses: pnpm/action-setup@v4
        with:
          version: 9

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'pnpm'

      - name: Install dependencies
        run: pnpm install --frozen-lockfile

      - name: Pull Vercel Environment Information
        run: pnpm exec vercel pull --yes --environment=production --token=${{ secrets.VERCEL_TOKEN }}

      - name: Build Project Artifacts
        run: pnpm exec vercel build --prod --token=${{ secrets.VERCEL_TOKEN }}

      - name: Deploy Project Artifacts to Vercel
        run: pnpm exec vercel deploy --prebuilt --prod --token=${{ secrets.VERCEL_TOKEN }}</code></pre>
                </div>
            </section>

            <section id="setup">
                <h2>Setup</h2>

                <h3>Create Workflow File</h3>
                <div class="code-block">
                    <div class="code-header">
                        <span>bash</span>
                        <button onclick="copyCode(this)">Copy</button>
                    </div>
                    <pre><code># Create .github/workflows directory
mkdir -p .github/workflows</code></pre>
                </div>
            </section>

            <section id="vercel-secrets">
                <h2>Add Vercel Secrets</h2>
                <ol class="steps-list">
                    <li>Go to <a href="https://vercel.com/account/tokens" target="_blank">vercel.com/account/tokens</a></li>
                    <li>Create a new token with <strong>Read & Write</strong> access</li>
                    <li>Go to your repo â†’ <strong>Settings</strong> â†’ <strong>Secrets and variables</strong> â†’ <strong>Actions</strong></li>
                    <li>Click <strong>New repository secret</strong></li>
                    <li>Add <code>VERCEL_TOKEN</code> with your token value</li>
                </ol>

                <div class="info-box">
                    <strong>ðŸ’¡ Note</strong>
                    <p>You don't need to add Vercel ORG_ID or PROJECT_ID as secrets - the workflow pulls this automatically from Vercel.</p>
                </div>
            </section>

            <section>
                <div class="success-box">
                    <strong>âœ… How It Works</strong>
                    <ul>
                        <li><strong>On PR</strong>: Runs lint â†’ tests â†’ build (no deploy)</li>
                        <li><strong>On push to main/master</strong>: Runs all checks + deploys to Vercel</li>
                        <li><strong>If any check fails</strong>: Deployment is blocked</li>
                    </ul>
                </div>

                <div class="nav-buttons">
                    <a href="deployment.html" class="btn btn-primary">Next: Deployment â†’</a>
                </div>
            </section>
        </article>
    </main>

    <footer>
        <p>Built for developers who want a production-ready React setup</p>
    </footer>

    <script>
        function copyCode(button) {
            const code = button.closest('.code-block').querySelector('code').textContent;
            navigator.clipboard.writeText(code);
            button.textContent = 'Copied!';
            setTimeout(() => button.textContent = 'Copy', 2000);
        }
    </script>
</body>
</html>
